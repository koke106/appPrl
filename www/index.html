<!DOCTYPE html>
<html>
  <head>
    <title>Device Properties Example</title>

    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.12.2.min.js"></script>
    <!--<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCTj2UDMMYLM28CcqpQBGmycxMeUslXbRE"></script>
    <script src="https://rawgit.com/HPNeo/gmaps/master/gmaps.js"></script>-->
  
<script type="text/javascript">
    document.addEventListener("deviceready", onDeviceReady, false);

    function onDeviceReady() {
        navigator.geolocation.getCurrentPosition(onSuccess, onError);
    }
    function onSuccess(position) {
        var element = document.getElementById('geolocation');
        /*element.innerHTML = 'Latitude: '           + position.coords.latitude              + '<br />' +
                            'Longitude: '          + position.coords.longitude             + '<br />' +
                            'Altitude: '           + position.coords.altitude              + '<br />' +
                            'Accuracy: '           + position.coords.accuracy              + '<br />' +
                            'Altitude Accuracy: '  + position.coords.altitudeAccuracy      + '<br />' +
                            'Heading: '            + position.coords.heading               + '<br />' +
                            'Speed: '              + position.coords.speed                 + '<br />' +
                            'Timestamp: '          + position.timestamp                    + '<br />';

        /*var map = new GMaps({
                div: '#basic_map',
                lat: position.coords.latitude,
                lng: position.coords.longitude,
                width: '500px',
                height: '500px',
                zoom: 12,
                zoomControl: true,
                
                zoomControlOpt: {
                    style: 'SMALL',
                    position: 'TOP_LEFT'
                },
                panControl: false
        });
        map.addMarker({
            lat: position.coords.latitude,
            lng: position.coords.longitude,
            title: 'Yo',
        });*/

    }
    function onError(error) {
        console.log('code: '    + error.code    + '\n' +
              'message: ' + error.message + '\n');
    }

    </script>
<!---  AIzaSyCTj2UDMMYLM28CcqpQBGmycxMeUslXbRE --> 
  </head>
  <body style="position: relative; margin:0 auto; text-align: center; width: 100%;">
    <div id="cabecera">
        <div style="float: left; position: absolute; margin: 0 auto; margin-left:2em;" id="flechaBack"><img src="home.png" onclick="atras();"></div>
        <h1>PRL</h1>
    </div>
    <div id="cuerpo">

        <div id="basic_map"></div>
        <div id="onlineOffline">
                <input type="button" name="Trabajar Offline" value="Trabajar Offline" onclick="modoOffline();"><br/>
                <input style="margin-top:2em;"  type="button" name="Trabajar Online" value="Trabajar Online" onclick="modoOnline();">
        </div>
        <!--OFFLINE-->
        <div id="modoOffline" style="display:none;">
            <input style="margin-bottom: 4em;" type="button" name="Nueva Revisi&oacute;n" value="Nueva Revisi&oacute;n" onclick="abreNuevoForm();"><br/>
            <span>OBRA EJEMPLO 1 . CERRADA</span><br/>
            <span>OBRA EJEMPLO 2 . CERRADA</span><br/>
            <span>OBRA EJEMPLO 3 . CERRADA</span><br/>
            <span>OBRA EJEMPLO 4 . CERRADA</span><br/>
        </div>        
        <div id="nuevoNombreForm" style="display:none;">
            <input type="text" value="" placeholder="Nombre Obra" id="obraName" >
            <input type="button" value="Crear Nueva Revision" name="Crear Nueva Revision" onclick="guardaFormTmp();">
        </div>
        <!--ONLINE-->
        <div id="modoOnline" style="display:none;">
            <select id="seleccionObra">
                <option value="0" selected>Seleccione una obra</option>
                <option value="1">Obra 1</option>
                <option value="2">Obra 2</option>
                <option value="3">Obra 3</option>
                <option value="4">Obra 4</option>
            </select>            
            <input type="button" name="Nueva Revisi&oacute;n" value="Nueva Revisi&oacute;n" onclick="abreNuevoForm();">
        </div>


        <div id="form" style="display:none;">
            <h1 id="nombreFormularioTmp">FORMULARIO</h1>

                <h2 id="cabeceraFormDocumentacion">DOCUMENTACION</h2>
                    <span>Se dispone en la obra de Plan de Seguridad y Salud / Plan de Medidas Preventivas de los trabajos</span><br/>
                    <form>
                        <input type="radio" name="21" value="Si">Si
                        <input type="radio" name="21" value="No">No
                    </form>
                <h2 id="cabeceraFormLugarTrabajo">LUGAR DE TRABAJO</h2>
                    <span>El espacio de trabajo est√° limpio y ordenado</span><br/>
                    <form>
                        <input type="radio" name="22" value="Si">Si
                        <input type="radio" name="22" value="No" onclick="abreCamaraFoto('22');">No
                        <input type="radio" name="22" value="Np">Np<br/>
                    </form>
                    <span>Estan delimitadas las zonas de trabajo de las zonas de transito</span><br/>
                    <input type="radio" name="23" value="Si">Si
                    <input type="radio" name="23" value="No" onclick="abreCamaraFoto('21');">No
                    <input type="radio" name="23" value="Np">Np<br/>
        </div>

    </div>
    




    <div id="pie"></div>
    <input type="hidden" id="onlOffl" value="">
    <input type="hidden" id="zonaSel" value=""> 
    <input type="hidden" id="carpetaTmpName" value=""> 
  </body>
</html>

<script>
function atras(){
    $('#basic_map').css('display','block');   
    $('#onlineOffline').css('display','block'); 

    $('#modoOnline').css('display','none'); 
    $('#nuevoNombreForm').css('display','none'); 
    $('#modoOffline').css('display','none'); 
    $('#form').css('display','none'); 
}
function modoOffline(){
    $('#onlOffl').val('0');
    $('#modoOffline').css('display','block');    
    $('#modoOnline').css('display','none'); 

    $('#onlineOffline').css('display','none'); 
    $('#basic_map').css('display','none');  
      
}

function modoOnline(){
    $('#onlOffl').val('1');
    $('#modoOnline').css('display','block');
    $('#modoOffline').css('display','none');

    $('#onlineOffline').css('display','none'); 
    $('#basic_map').css('display','none');  
}

function abreNuevoForm(){
    if($('#onlOffl').val()==0){
        $('#nuevoNombreForm').css('display','block');
        $('#modoOffline').css('display','none');
    }else{
        alert('estamos en online'+$('#seleccionObra').val());
        $('obraNombre').val($('#seleccionObra').val()); 
        $('#form').css('display','block'); 
        $('#obraName').val($('#seleccionObra').val());
        window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onRequestFileSystemSuccess, null);
    }
    $('#modoOnline').css('display','none'); 
    $('#onlineOffline').css('display','none');    
}

function guardaFormTmp(){
    $('#modoOnline').css('display','none'); 
    $('#onlineOffline').css('display','none'); 
    $('#nuevoNombreForm').css('display','none'); 
    $('#form').css('display','block');  
    window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onRequestFileSystemSuccess, null); 
    
    //Mostramos el form con el nombre:
    $('#nombreFormularioTmp').html('');
    $('#nombreFormularioTmp').html('FORMULARIO: '+nombreObra);
    $('#form').css('display','block'); 
}

/**********CREAR DIRECTORIO************/
function onRequestFileSystemSuccess(fileSystem) {     
    var nombreObra = $('#obraName').val();
    nombreObra = nombreObra.replace(/\s/g,"_");
    nombreObra += '_0001';
    var entry=fileSystem.root; 
    entry.getDirectory(nombreObra, {create: true, exclusive: false}, onGetDirectorySuccess, onGetDirectoryFail); 
} 
function onGetDirectorySuccess(dir) { 
    alert("Created dir "+dir.fullPath); 
    $('#carpetaTmpName').val(dir.fullPath);
} 

function onGetDirectoryFail(error) { 
    alert("Error creating directory "+error.code); 
} 

/************CAMARA DE FOTOS**********/
function abreCamaraFoto(zona){
    console.log('zona->'+zona);
    $('#zonaSel').val(zona);    
    navigator.camera.getPicture(fotoOk, onFail, { 
        quality: 35, 
        destinationType: Camera.DestinationType.FILE_URI,
        encodingType: Camera.EncodingType.JPEG
    });
}
function fotoOk(imageURI) {
    alert('onSuccess');
    //image.src = imageURI;
    alert('getImageURI'+imageURI);
    var nombreImagen = imageURI.substring(imageURI.lastIndexOf('/')+1);
    
    var carpetaNombre = $('#carpetaTmpName').val();
    alert(' nombreImagen->'+nombreImagen+' carpetaNombre->'+carpetaNombre);
    imageURI.copyTo(carpetaNombre, 'newImg.jpg', moveSuccess, moveFail);

    
}
function onFail(message) {
    if (confirm('Quieres cambiar tu respuesta?')) {
        var pregunta = $('#zonaSel').val();
        alert('pregunta->'+pregunta);
        $('input:radio[name='+pregunta+']').attr('checked',false);
    }else{
        navigator.camera.getPicture(fotoOk, onFail, { quality: 50, destinationType: Camera.DestinationType.FILE_URI });
    }
    
}
function moveSuccess(){
    alert('FICHERO MOVIDO!');   
}
function moveFail(){
    alert('FICHERO FALLO!');   
}

</script>